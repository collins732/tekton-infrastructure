# -----------------------------------------------------------------------------
# Secrets
# Sensitive configuration - values should be base64 encoded
# In production, use Azure Key Vault with CSI driver instead
# -----------------------------------------------------------------------------

apiVersion: v1
kind: Secret
metadata:
  name: tekton-app-secrets
  namespace: tekton
  labels:
    app: tekton-app
type: Opaque
data:
  # Placeholder values - replace with actual base64 encoded secrets
  # echo -n "your-secret" | base64
  API_KEY: cGxhY2Vob2xkZXI=
  DATABASE_URL: cGxhY2Vob2xkZXI=

---
# -----------------------------------------------------------------------------
# SecretProviderClass for Azure Key Vault integration
# Syncs secrets from Key Vault to Kubernetes secrets
# -----------------------------------------------------------------------------

apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: azure-keyvault-secrets
  namespace: tekton
spec:
  provider: azure
  parameters:
    usePodIdentity: "false"
    useVMManagedIdentity: "true"
    userAssignedIdentityID: ""  # Set by overlay
    keyvaultName: ""            # Set by overlay
    cloudName: "AzurePublicCloud"
    objects: |
      array:
        - |
          objectName: api-key
          objectType: secret
        - |
          objectName: database-url
          objectType: secret
    tenantId: ""  # Set by overlay
  secretObjects:
    - secretName: tekton-app-kv-secrets
      type: Opaque
      data:
        - objectName: api-key
          key: API_KEY
        - objectName: database-url
          key: DATABASE_URL
